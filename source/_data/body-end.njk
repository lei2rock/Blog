{### 锚点定位 ###}
{% if page.comments or post.comments %}
<script{{ pjax }} type="text/javascript">
  if (window.location.hash) {
    var checkExist = setInterval(function () {
      if ($(window.location.hash).length) {
        $('html, body').animate({
          scrollTop: $(window.location.hash).offset().top - 90
        }, 1000);
        clearInterval(checkExist);
      }
    }, 100);
  }
</script>
{% endif %}


{### 友链生成 ###}
<script{{ pjax }} type="text/javascript">
  //jquery selector
  var $linkLists = $(".link-list");
  if($linkLists.length != 0){
    var j = -1;
    for	(var i = 0; i < $linkLists.length; i++) {
      var listPath = $linkLists[i].getAttribute('src');
      //使用 getJSON 读取 JSON 文件中的数据
      $.getJSON(listPath, function(data) {
        j++;
        //存储数据的变量 
        var li = "";
        //清空内容 
        $linkLists.eq(j).empty();
        //将获取到的 json 格式数据遍历到 div 中
        $.each(data, function(infoIndex, info) {
          var labelWarn = '';
          var labelInfo = '';
          if(info['warn']) { 
            labelWarn = '<span class="label warn">' + info['warn'] + '</span>';
          }
          if(info['info']) { 
            labelInfo = '<span class="label info">' + info['info'] + '</span>';
          }
          li += '<div class="link-list-container">';
          li += '<img class="link-list-image" src="' + info['logo'] + '">';
          li += '<p>' + info['title'] + labelInfo + labelWarn + '</p>';
          li += '<p>' + info['intro'] + '</p>';
          li += '<a href="' + info['url'] + '" rel="noopener" target="_blank" data-pjax-state=""></a>';
          li += '</div>';
        })
        //显示处理后的数据 
        $linkLists.eq(j).html(li);
      })
    }
  }
</script>


{### 相册 ###}
<script src="https://jsd.pinlyu.com/npm/minigrid@3.1.1/dist/minigrid.min.js"></script>
<script{{ pjax }} type="text/javascript">
var $album = $(".album")[0];
if($album) {
  // 相册列表 JSON 数据
  var imgDataPath = $album.getAttribute('json-src');
  // 照片存储路径
  var imgPath = $album.getAttribute('photo-src');
  // 最多显示数量
  var imgMaxNum = 50;
  // 获取窗口大小以决定图片宽度
  var windowWidth = window.innerWidth
  || document.documentElement.clientWidth
  || document.body.clientWidth;
  if (windowWidth < 768) {
      var imageWidth = 145; // 移动端图片宽度
  } else {
      var imageWidth = 235;
  }

  // 腾讯云 COS 自定义样式格式
  //var imgStyle = '!' + imageWidth + 'x';
  var imgStyle = '!300x';

  // 生成相册
  var LinkDataPath = imgDataPath;
  photo = {
      page: 1,
      offset: imgMaxNum,
      init: function () {
          var that = this;
          $.getJSON(LinkDataPath, function (data) {
              that.render(that.page, data);
          });
      },
      render: function (page, data) {
          var begin = (page - 1) * this.offset;
          var end = page * this.offset;
          if (begin >= data.length) return;
          var imgNameWithPattern, imgName, imageSize, imageX, imageY, li = "";
          for (var i = begin; i < end && i < data.length; i++) {
              imgNameWithPattern = data[i].split(' ')[1];
              imgName = imgNameWithPattern.split('.')[0]
              imageSize = data[i].split(' ')[0];
              imageX = imageSize.split('.')[0];
              imageY = imageSize.split('.')[1];
              li += '<div class="card" style="width:' + imageWidth + 'px" >'
              li += '<div class="album-photo" style="height:'+ imageWidth * imageY / imageX + 'px">'
              li += '<a class="fancybox fancybox.image" href="' + imgPath + imgNameWithPattern + '" itemscope="" itemtype="http://schema.org/ImageObject" itemprop="url" data-fancybox="group" rel="group" data-caption="' + imgName + '" title="' +  imgName + '">'
              li += '<img data-src="' + imgPath + imgNameWithPattern + imgStyle + '" src="' + imgPath + imgNameWithPattern + imgStyle + '" alt="' +  imgName + '" data-loaded="true">'
              li += '</a>'
              li += '</div>'
              li += '</div>'
          }
          $(".album").append(li);
          this.minigrid();
      },

      minigrid: function() {
        var grid = new Minigrid({
            container: '.album',
            item: '.card',
            gutter: 12
        });
        grid.mount();
        $(window).resize(function() {
            grid.mount();
        });
      }
  }
  photo.init();
}
</script>